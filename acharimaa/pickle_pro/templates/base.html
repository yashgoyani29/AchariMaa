{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AchariMaa</title>
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/bootstrap.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/CSS/styles.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/js/style.js'%}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/owl.carousel.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/owl.theme.default.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/owl.theme.green.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/hover-min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/ihover.css'%}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css" />
    <link rel="icon" type="image/png" href="{% static 'assets/images/icon.png' %}">

</head>
<body>
<!------------ Navbar Start ------------>
<div class="container-fluid  fixed-top text-dark py-1">
  <marquee behavior="scroll" direction="left" class="fw-semibold">
    <strong>Achari Maa</strong> | HAR BITE MAIN MAA KA PYAAR
  </marquee>
</div>

<nav class="navbar navbar-expand-lg mymenu co sticky-top bg-body-tertiary">
  <div class="container px-4 main">
    <!-- Logo -->
    <a class="navbar-brand" href="/">
      <img src="{% static 'assets/images/aacharimaa2.png' %}" alt="Achari Maa" height="50">
    </a>

    <!-- Hamburger -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Menu Items -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto me-4 mb-2 mb-lg-0 gap-2">
        <li class="nav-item"><a class="nav-link subul" href="{% url 'home' %}">Home</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle subul" href="#" id="ingredientsDropdown" role="button" data-bs-toggle="dropdown">
            Shop by Ingredients
          </a>
          <ul class="dropdown-menu menuu">
            <li><a class="dropdown-item subul" href="{% url 'mango' %}">Mango</a></li>
            <li><a class="dropdown-item subul" href="{% url 'Lemon' %}">Lemon</a></li>
            <li><a class="dropdown-item subul" href="{% url 'Mixed' %}">Mixed</a></li>
            <li><a class="dropdown-item subul" href="{% url 'Panjabi' %}">Panjabi</a></li>
            <li><a class="dropdown-item subul" href="{% url 'kerda' %}">Kerda</a></li>
            <li><a class="dropdown-item subul" href="{% url 'Carrot' %}">Carrot</a></li>
          </ul>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle subul" href="#" id="storyDropdown" role="button" data-bs-toggle="dropdown">
            Our Story
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item subul" href="{% url 'howwe' %}">How We</a></li>
            <li><a class="dropdown-item subul" href="{% url 'makeour' %}">Make Our</a></li>
            <li><a class="dropdown-item subul" href="{% url 'recipes' %}">Recipes</a></li>
          </ul>
        </li>

        <li class="nav-item"><a class="nav-link subul" href="{% url 'blogs' %}">Blogs</a></li>
        <li class="nav-item"><a class="nav-link subul" href="{% url 'Contact' %}">Contact Us</a></li>
        {% if request.user.is_authenticated %}
        <li class="nav-item"><a class="nav-link subul" href="{% url 'ordercomplete' %}">Order Complete</a></li>
        {% endif %}
      </ul>
    </div>
      <!-- Right Side Icons -->
      <div class="d-flex align-items-center gap-2">
        {% if request.user.is_authenticated %}
          <!-- Logout -->
          {% csrf_token %}
          <a id="logoutBtn" class="btn btt" href="#" onclick="confirmLogout()" title="Logout">
            <i class="bi bi-box-arrow-right"></i>
          </a>
          <script>
            function confirmLogout() {
              if (confirm("Are you sure you want to log out?")) {
                window.location.href = "{% url 'logout' %}";
              }
            }
          </script>
          <a class="btn btt position-relative" href="{% url 'cart' %}" title="Cart">
            <i class="fas fa-shopping-cart"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ cart_count }}
              </span>
  
          </a>
        {% else %}
          <!-- Login -->
          <a class="btn btt" href="{% url 'login' %}" title="Login">
            <i class="bi bi-person-fill"></i>
          </a>
          <!-- Cart Button -->
          <a class="btn btt position-relative" href="#"
          title="Cart"
          onclick="handleCartClick(event)">
          <i class="fas fa-shopping-cart"></i>
          </a>

          <script>
          function handleCartClick(event) {
          const isLoggedIn = {{ request.user.is_authenticated|yesno:"true,false" }};
          if (!isLoggedIn) {
            event.preventDefault(); // stop the default link
            alert("Please login to view your cart.");
            window.location.href = "{% url 'login' %}";
          } else {
            window.location.href = "{% url 'cart' %}";
          }
          }
          </script>

        {% endif %}

        <!-- Cart Button -->
       
      </div>
    
  </div>
</nav>



<script>
function addToCart() {
    // Example: Simulate adding to cart (you'd use actual data here)
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.push({ id: 1, name: "Mango", quantity: 1 });
    localStorage.setItem('cart', JSON.stringify(cart));

    // Redirect to cart page
    window.location.href = '{% url 'cart' %}';
}
</script>

<!------------ Navbar End ---------------->
<!------------ TopButton Start ---------------->
<button id="topBtn" class="btn"><i class="bi bi-arrow-up-circle"></i></button>
<!------------ TopButton End ---------------->

{% block main-content %}
{% endblock main-content %}

<!------------ Footer Start ------------>
<footer class="bg-light p-4">
 <div class="container text-center text-md-start">
   <div class="row">
    <div class="col-lg-7 col-md-12 mt-4">
      <div class="table-responsive">
        <table class="table table-borderless text-center text-md-start">
          <thead class="fw-bold text-uppercase">
            <tr>
              <th scope="col">Shop</th>
              <th scope="col">Shop</th>
              <th scope="col">Policies</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><a class="dropdown-item" href="{% url 'mango' %}">Mango Pickle</a></td>
              <td><a class="dropdown-item" href="{% url 'Panjabi' %}">Panjabi Pickle</a></td>
              <td><a class="dropdown-item" href="{% url 'term' %}">Terms and Conditions</a></td>
            </tr>
            <tr>
              <td><a class="dropdown-item" href="{% url 'Lemon' %}">Lemon Pickle</a></td>
              <td><a class="dropdown-item" href="{% url 'kerda' %}">Kerda Pickle</a></td>
              <td><a class="dropdown-item" href="{% url 'privacypolicy' %}">Privacy Policy</a></td>
            </tr>
            <tr>
              <td><a class="dropdown-item" href="{% url 'Mixed' %}">Mixed Pickle</a></td>
              <td><a class="dropdown-item" href="{% url 'Carrot' %}">Carrot Pickle</a></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div> 

     <div class="col-lg-5 col-md-12 text-center mt-4 foot">
       <img src="{% static 'assets/images/aacharimaa3.png'%}" class="hvr-pulse-grow rounded" width="120px">
       <p class="mt-3 mb-3"><b>FOLLOW US FOR ACHARIMAA</b></p>
       <ul class="list-inline">
        <li class="list-inline-item">
          <a href="https://www.instagram.com/achari_maa?utm_source=qr&igsh=eDRxbnRyZ2h1Nmtp" class="hvr-pulse-grow" data-bs-toggle="tooltip" data-bs-placement="top" title="Instagram">
            <i class="rounded fa-brands fa-square-instagram"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a href="https://www.facebook.com/share/18i9pBpKY1/?mibextid=qi2Omg" class="hvr-pulse-grow" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook">
            <i class="rounded fa-brands fa-facebook"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a href="https://wa.me/9316919201" target="_blank"  class="hvr-pulse-grow"  data-bs-toggle="tooltip"  data-bs-placement="top"  title="Chat with us on WhatsApp">
            <i class="rounded fa-brands fa-square-whatsapp"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a href="https://www.youtube.com/@acharimaa" class="hvr-pulse-grow" title="YouTube">
            <i class="rounded fa-brands fa-youtube"></i>
          </a>
        </li>
      </ul>
      
     </div> 
     <div class="light p-2">
       <div class="container-fluid">
           <hr>
           <p class="float-end">Designed By Yash Goyani</p>
           <p>&copy; 2024 - All Rights Reserved</p>
       </div>
     </div>

</footer> 
         <!------------ Footer End ------------>
   
</body>
<script src="{% static '/assets/js/jquery.min.js'%}" type="text/javascript"></script>
<script src="{% static '/assets/js/owl.carousel.min.js'%}" type="text/javascript"></script>
<script src="{% static '/assets/js/bootstrap.bundle.min.js'%}" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script type="text/javascript">
 $('.owl-carousel').owlCarousel({
   loop:true,
   margin:10,
   nav:false,
   responsive:{
       0:{
           items:1
       },
       600:{
           items:1
       },
       1000:{
           items:3
       }
   }
})

window.onscroll = function () {
 let topBtn = document.getElementById("topBtn");
 if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
     topBtn.style.display = "block";
 } else {
     topBtn.style.display = "none";
 }
};

document.getElementById("topBtn").addEventListener("click", function () {
 window.scrollTo({ top: 0, behavior: "smooth" });
});

let totalPrice = 0;

       document.addEventListener("DOMContentLoaded", function () {
           document.querySelectorAll(".size-option").forEach(item => {
               item.addEventListener("click", function (e) {
                   e.preventDefault();
                   let parent = this.closest(".dropdown");
                   let dropdownText = parent.querySelector(".selected-price");
                   dropdownText.innerHTML = `${this.dataset.size} - Rs ${this.dataset.price}`;
                   dropdownText.setAttribute("data-price", this.dataset.price);
                   dropdownText.setAttribute("data-size", this.dataset.size);
               });
           });

           document.querySelectorAll(".add-to-cart").forEach(button => {
               button.addEventListener("click", function () {
                   let productCard = this.closest('.card');
                   let productName = productCard.querySelector(".product-name").textContent.trim();
                   let productImage = productCard.querySelector(".product-image").src;
                   let selectedSizeElement = productCard.querySelector('.selected-price');
                   let selectedSize = selectedSizeElement.getAttribute("data-size");
                   let selectedPrice = parseInt(selectedSizeElement.getAttribute("data-price"));
                   let cartItems = document.getElementById("cart-items");
                   let existingItem = [...cartItems.children].find(item => 
                       item.dataset.name === productName && item.dataset.size === selectedSize
                   );

                   if (existingItem) {
                       let quantityElement = existingItem.querySelector(".item-quantity");
                       let quantity = parseInt(quantityElement.textContent);
                       quantityElement.textContent = quantity + 1;
                   } else {
                       let cartItem = document.createElement("li");
                       cartItem.className = "list-group-item d-flex align-items-center";
                       cartItem.dataset.name = productName;
                       cartItem.dataset.size = selectedSize;
                      
                       cartItem.innerHTML = `
                         <img src="${productImage}" width="50" height="50" class="me-2">
                         <div class="cart-item-details">
                             <div>${productName}</div>
                             <div>(${selectedSize}) - Rs ${selectedPrice}</div>
                         </div>
                         <span class="count">
                             <button class="quantity-btn" onclick="updateQuantity(this, -1, ${selectedPrice})">-</button>
                             <span class="badge bg-primary rounded-pill item-quantity">1</span>
                             <button class="quantity-btn" onclick="updateQuantity(this, 1, ${selectedPrice})">+</button>
                         </span>
                         <button class="delete-btn dbtn" onclick="removeFromCart(this, ${selectedPrice})"><i class="bi bi-trash"></i></button>
                     `;
                     cartItems.appendChild(cartItem);
                   }

                   totalPrice += selectedPrice;
                   document.getElementById("total-price").innerText = totalPrice;
                   let offcanvas = new bootstrap.Offcanvas(document.getElementById("offcanvasaddtocart"));
                   offcanvas.show();
               });
           });
       });

       function updateQuantity(button, change, price) {
           let cartItem = button.closest("li");
           let quantityElement = cartItem.querySelector(".item-quantity");
           let quantity = parseInt(quantityElement.textContent) + change;

           if (quantity > 0) {
               quantityElement.textContent = quantity;
               totalPrice += change * price;
           } else {
               cartItem.remove();
               totalPrice -= price;
           }

           document.getElementById("total-price").innerText = totalPrice;
       }

       function removeFromCart(button, price) {
           let cartItem = button.closest("li");
           let quantityElement = cartItem.querySelector(".item-quantity");
           let quantity = parseInt(quantityElement.textContent);
           totalPrice -= price * quantity;
           cartItem.remove();
           document.getElementById("total-price").innerText = totalPrice;
       }

     function placeOrder() {
       window.location.href = "order.html";
     }

     document.getElementById("signup-form").addEventListener("submit", function(event) {
       event.preventDefault();
       alert("Account created successfully!");
   });
     
       function changeQuantity(index, change) {
           let item = cart[index];
           if (change === -1 && item.quantity === 1) {
               cart.splice(index, 1); 
           } else {
               item.quantity += change;
           }
           updateCart();
       }

    function handleSignup(event) {
        var mobile = document.getElementById("mobile").value;
        var mobileRegex = /^[0-9]{10}$/;

        if (!mobileRegex.test(mobile)) {
            document.getElementById("signup-error").innerText = "Invalid mobile number!";
            event.preventDefault();  // Prevent form submission only if validation fails
        } else {
            document.getElementById("signup-error").innerText = "";
        }
  
        let offcanvas = new bootstrap.Offcanvas(document.getElementById('offcanvasRight'));
            offcanvas.show();
            
            alert("Sign-up successful! Please log in.");
      }

    document.getElementById("checkout-form").addEventListener("submit", function(event) {
      event.preventDefault();
      alert("Order placed successfully!");
    });
       
    document.addEventListener("DOMContentLoaded", function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
      });
  
      document.getElementById("logoutBtn")?.addEventListener("click", function () {
          var confirmLogout = confirm("Are you sure you want to logout?");
          if (confirmLogout) {
              window.location.href = "{% url 'logout' %}"; 
          }
      });
    });
  
  $(document).on("click", ".size-option", function (e) {
    e.preventDefault();
    var price = $(this).data("price");
    var size = $(this).data("size");
    $(this).closest('.dropdown').find('.selected-price').text(size + " - Rs " + price);
    $(this).closest('.dropdown').find('.selected-price').data("price", price);
  });
</script>
</html>